---
layout: default
title: iroha
parent: Hyperledger
grand_parent: Pull Requests
has_children: false
permalink: /pull-requests/hyperledger/iroha
---

# iroha <span class="fs-3 right-align">[GitHub](https://github.com/hyperledger/iroha){: .btn .mr-4 }</span>


<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3873" class=".btn">#3873</a>
            </td>
            <td>
                <b>
                    [feature] #1915: Implement Fast kura init mode
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

Implement `fast` kura init mode.
Which can skip loading blocks from disk and thus bootstrap startup time. 

<!-- Just describe what you did. -->

<!-- Skip if the title of the PR is self-explanatory -->

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

Closes #1915 <!-- Replace with an actual number,  -->

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits

Improve startup time.


### Downsides

Take additional space for storing hashes on disk (32 bytes per hash) time/memory tradeoff.

`fast` init mode should be used with caution because it can detect some mutations in hashes file. 

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### How to test

1. Run iroha with `strict` kura init mode
2. Create couple of blocks
3. Check that `storage/blocks.hashes` is created
4. Shutdown iroha peer
5. Switch to `fast` kura init mode in the configuration
6. Start peer again
7. Check that peer is running correctly
8. Shutdown iroha peer ones more
9. Make backup of `storage/blocks.hashes` (`storage/blocks.hahses.old`)
10. Remove some data from data from `storage/blocks.hashes` or whole file entirely
11. Start peer
12. Check that kura failed to load in `fast` mode and failed back to STRICT mode (grep for “Hashes file is broken”)
13. Check that peer is running correctly
14. Check that `storage/blocks.hashes` is restored (`storage/blocks.hashes` == `storage/blocks.hashes.old`)
15. Check that peer is running correctly

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-07 07:40:53 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3872" class=".btn">#3872</a>
            </td>
            <td>
                <b>
                    [feature] #3868: Add iroha_swarm disclaimer header
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">Enhancement</span><span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

<!-- Just describe what you did. -->

<!-- Skip if the title of the PR is self-explanatory -->

Added disclaimer about files being generated by `iroha_swarm`

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

- Closes #3868 <!-- Replace with an actual number,  -->

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits

Now it's obvious that files are generated by a program and not written by hand

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### Checklist

- [x] I've read `CONTRIBUTING.md`
- [x] I've used the standard signed-off commit format (or will squash just before merging)
- [x] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-06 12:27:00 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3870" class=".btn">#3870</a>
            </td>
            <td>
                <b>
                    [docs]: #391 move the Rust examples
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

This is a draft PR that moves code from the blocks in `iroha-2-docs` repo.

### Linked issue

Closes #391

### Benefits

Docs will be more clean and the doctests will be more detailed.

### Checklist

- [x] I've read `CONTRIBUTING.md`
- [x] I've used the standard signed-off commit format (or will squash just before merging)
- [x] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-06 07:56:17 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3869" class=".btn">#3869</a>
            </td>
            <td>
                <b>
                    [refactor] #3526: Allow only a fixed set of signature verification conditions
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

Instead of allowing arbitrary iroha expressions in `SignatureVerificationCondition`, allow only a fixed set of verification conditions

### Linked issue

Closes #3526

<!-- ### Benefits -->



### Checklist

- [x] Decide on the set of signature check conditions we want to allow
- [ ] Add unit tests
- [x] Implement without using expressions
- [ ] Make `SignatureVerificationCondition` non-ffi-opaque (?)
            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-06 06:20:59 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3866" class=".btn">#3866</a>
            </td>
            <td>
                <b>
                    [fix] #3337: Better error message for query find error
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">Bug</span><span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

- `QueryExecutionFail::Find` variant is now transparent
- `FindError` derives `displaydoc::Display` and not `derive_more::Display`

<!-- Just describe what you did. -->

<!-- Skip if the title of the PR is self-explanatory -->

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

- Closes #3337 <!-- Replace with an actual number,  -->

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits

Better error message:

```
Error:
   0: Failed to mint asset of type `NumericValue::U32`
   1: Failed to submit transaction V1(SignedTransaction { signatures: iroha_crypto::signature::SignaturesOf<iroha_data_model::transaction::model::TransactionPayload> { signatures: {iroha_crypto::signature::SignatureOf<iroha_data_model::transaction::model::TransactionPayload>({ pub_key: ed01207233BFC89DCBD68C19FDE6CE6158225298EC1131B6A130D1AEB454C1AB5183C0, payload: 95E2E087054FDBC56BEC183723C23E6BCD114A90B240DA7C255A508C7C5463E4F2153BA93499F3FFAF37C7A254A39107E3EECF5A6F0FC31FE0D2B544644A2B0B })} }, payload: TransactionPayload { creation_time_ms: 1693853747365, authority: alice@wonderland, instructions: [MintBox { object: 100_u32, destination_id: AssetId(tea##mad_hatter@looking_glass) }], time_to_live_ms: Some(100000), nonce: None, metadata: {} } })
   2: Transaction was rejected
   3: Validation failed
   4: Query execution failed
   5: Failed to find domain: `looking_glass`
```

(compare with the one from issue)

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### Checklist

- [x] I've read `CONTRIBUTING.md`
- [x] I've used the standard signed-off commit format (or will squash just before merging)
- [x] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-04 18:57:05 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3864" class=".btn">#3864</a>
            </td>
            <td>
                <b>
                    [fix] #3712: Add genesis account public key to dev docker compose
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">Bug</span><span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

Add missing `IROHA_GENESIS_ACCOUNT_PUBLIC_KEY` env vars into `docker-compose.dev.yml`

<!-- Just describe what you did. -->

<!-- Skip if the title of the PR is self-explanatory -->

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

- Closes #3712 <!-- Replace with an actual number,  -->

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits

`docker compose -f docker-compose.dev.yml up` works

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### Checklist

- [x] I've read `CONTRIBUTING.md`
- [x] I've used the standard signed-off commit format (or will squash just before merging)
- [x] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-04 12:22:56 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3862" class=".btn">#3862</a>
            </td>
            <td>
                <b>
                    Trying to upgrade libraries in VCPKG
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">version bump</span><span class="chip">1.x</span><span class="chip">1.5</span>
            </td>
            <td>
                ## Description
In PR https://github.com/hyperledger/iroha/pull/3852/ I needed to revert upgrading VCPKG. It caused libraries to downgrade. So now we need to try to upgrade libraries manually one by one.

Corrections (marked as [x] when CI passed):
- [x] iroha-ed25519 (no updates)
- [x] protobuf 3.15.8 -> 3.21.12
- [x] abseil 2021-03-24 -> 20230125.0
- [x] benchmark 1.5.2 -> 1.7.1
- [x] gflags 2.2.2-1 -> 2.2.2#5
- [x] nlohmann-json 3.9.1 -> 3.11.2
- [x] rapidjson 2020-09-14 -> 2022-06-28#3
- [x] rxcpp 4.1.0-1 -> 4.1.1#1
- [x] rocksdb 6.14.6 -> 7.9.2
- [ ] fmt 7.1.3#4 -> 9.1.0#1 - PROBLEM with upgrading library with patch
- [ ] spdlog 1.8.5#2 -> 1.11.0 - PROBLEM with upgrading library with patch
- [ ] gtest 1.10.0#4 -> 1.13.0 - PROBLEM with upgrading library with patch
- [ ] grpc 1.37.0#1 -> 1.51.1 - PROBLEM with upgrading library with patch
- [ ] soci[boost,postgresql] - PROBLEM with upgrading library with patch
- [ ] prometheus-cpp 0.12.2 -> 1.1.0 - PROBLEM with upgrading library with patch
- [ ] boost-* - PROBLEM with upgrading library with patch

<!-- Just describe what you did. -->

<!-- Skip if the title of the PR is self-explanatory -->

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

Closes #{issue_number} <!-- Replace with an actual number,  -->

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits
Newer packages - it will compile longer, less bugs, more security etc.

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### Checklist

- [ ] I've read `CONTRIBUTING.md`
- [ ] I've used the standard signed-off commit format (or will squash just before merging)
- [ ] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

# More information:
I was using the tutorial (as inspiration): https://stackoverflow.com/questions/72588408/vcpkg-how-to-edit-package-file-when-compilation-fails-when-installing-package
1. First I've build all packages with VCPKG in newest versions (details: https://github.com/hyperledger/iroha/pull/3852)
2. Then I used older version of vcpkg (+ packages).
3. I've created repository in `./vcpkg-build`
4. For each patch I've used the function:
```
function update_library
{
    # this function should be run in vcpkg-build directory, where sub-repository is initialised 
    # according to: https://stackoverflow.com/questions/72588408/vcpkg-how-to-edit-package-file-when-compilation-fails-when-installing-package
    library_name=$1
    source_directory_name_to_copy_files='vcpkg-build_newest' # remember to set proper name
    echo "Trying to update: $library_name, from version: $(./vcpkg list | grep $library_name)"
    
    rm ports/${library_name}/*
    cp ../${source_directory_name_to_copy_files}/ports/${library_name}/* ports/${library_name}/
    git add ports/${library_name}/
    git status
    git diff --cached > ../vcpkg/patches/upgrade_${library_name}_to_.patch
    git reset --hard
}
# example:
update_library protobuf
```
            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-02 09:26:47 +0000 UTC
    </div>
</div>

<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/iroha/pull/3859" class=".btn">#3859</a>
            </td>
            <td>
                <b>
                    BACKPORT [fix] #3853: Compare permission token payload as JSON
                </b>
            </td>
        </tr>
        <tr>
            <td>
                <span class="chip">iroha2</span>
            </td>
            <td>
                ## Description

<!-- Just describe what you did. -->

Backport of #3855 

### Linked issue

<!-- Duplicate the main issue and add additional issues closed by this PR. -->

Closes #3853

<!-- Link if e.g. JIRA issue or  from another repository -->

### Benefits

<!-- EXAMPLE: users can't revoke their own right to revoke rights -->

### Checklist

- [ ] I've read `CONTRIBUTING.md`
- [ ] I've used the standard signed-off commit format (or will squash just before merging)
- [ ] All applicable CI checks pass (or I promised to make them pass later)
- [ ] (optional) I've written unit tests for the code changes
- [ ] I replied to all comments after code review, marking all implemented changes with thumbs up

<!-- HINT:  Add more points to checklist for large draft PRs-->

<!-- USEFUL LINKS 
 - https://www.secondstate.io/articles/dco
 - https://discord.gg/hyperledger (please ask us any questions)
 - https://t.me/hyperledgeriroha (if you prefer telegram)
-->

            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2023-09-01 10:09:29 +0000 UTC
    </div>
</div>


---
layout: default
title: firefly-tokens-erc20-erc721
parent: Hyperledger
grand_parent: Pull Requests
has_children: false
permalink: /pull-requests/hyperledger/firefly-tokens-erc20-erc721
---

# firefly-tokens-erc20-erc721 <span class="fs-3 right-align">[GitHub](https://github.com/hyperledger/firefly-tokens-erc20-erc721){: .btn .mr-4 }</span>


<div>
    <table>
        <tr>
            <td>
                PR <a href="https://github.com/hyperledger/firefly-tokens-erc20-erc721/pull/104" class=".btn">#104</a>
            </td>
            <td>
                <b>
                    Support passing an ABI directly in any mint/burn/transfer/approval call
                </b>
            </td>
        </tr>
        <tr>
            <td>
                
            </td>
            <td>
                In a chain with #103.
Part of [FIR-16](https://github.com/hyperledger/firefly-fir/pull/16).

**Background**
Currently this connector supports a small set of ABIs, which are checked in to `src/abi`. There are 2 flavors of ERC20 (ERC20NoData and ERC20WithData) and 2 of ERC721 (ERC721NoData and ERC721WithData). When a new pool is created, the connector probes the contract (via ERC165 "supportsInterface") to determine if it is the "WithData" variant. If not, it assumes it is the "NoData" variant. From that point forward, whenever a mint/burn/transfer/approval call is needed, the connector refers to the ABI that it inferred for the contract, in order to determine what method to call.

This works for many cases, but does not cover all common variants of these contracts. However, expanding beyond 2 flavors of each within the current system (ie continuing to rely on probing the contract and making educated guesses about its methods) could quickly become complex and fragile.

**New Enhancements**
With this PR, the mint/burn/transfer/approval APIs all accept a new `interface: { abi: [ ... ] }` parameter. If this is populated with a list of ABI methods, the connector will look at this list _instead_ of any ABI it has previously inferred, to see if the list contains a method it knows how to use.

In addition, the connector now understands some additional flavors of mint/burn methods that are generated by OpenZeppelin (and which differ slightly from any variant in the 4 ABIs checked in to this connector). This means that a contract using these other flavors of mint/burn can now be utilized by the connector, as long as the ABI (or relevant portion of it) is passed in on the mint/burn HTTP request. This is demonstrated and verified in a few new Jest E2E tests.

**Breaking Changes**
The `info.uri` field will no longer be populated when creating a non-fungible pool against a pre-deployed ERC721 that has a base token URI configured. Justification for this:
* It relied on a `baseTokenUri()` method that is not part of the ERC721 standard (unlike other queryable methods like `name` and `symbol`, which are defined in the standard)
* It was inconsistent in that `info.uri` would be populated for pre-deployed ERC721 contracts, but _not_ for ERC721 contracts deployed asynchronously by a factory
* The field is not used by FireFly, and as far as I'm aware, is not widely used in application development (if at all)
* The `baseTokenUri()` method is left in place on the sample ERC721 contract, so it still can be queried directly if needed, even though the connector will no longer query it

**Future Plans**
Currently the changes in this PR won't be exercised in actual FireFly deployments, because FireFly does not pass an ABI to mint/burn/transfer/approval calls. A follow-on step will be to add the ability in FireFly to tie a contract interface to a token pool at creation time, and then cause it to pass the ABI (or a subset) to mint/burn/transfer/approval calls within that pool.
            </td>
        </tr>
    </table>
    <div class="right-align">
        Created At 2022-12-28 17:50:53 +0000 UTC
    </div>
</div>

